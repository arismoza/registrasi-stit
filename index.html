<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrasi STIT DF</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background: #f0f2f5; padding: 15px; }
        .card { max-width: 550px; margin: auto; border-radius: 20px; border: none; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .card-header { background: #1a5f7a; color: white; text-align: center; border-radius: 20px 20px 0 0 !important; padding: 25px; }
        .btn-primary { background: #1a5f7a; border: none; }
        #loading { display: none; }
    </style>
</head>
<body>
    <div class="card">
        <div class="card-header"><h4>STIT DARUL FATAH</h4><p class="mb-0">Portal Registrasi Mahasiswa</p></div>
        <div class="card-body p-4">
            <form id="regForm">
                <div class="mb-3"><label class="form-label fw-bold">Nama Lengkap</label><input type="text" name="nama" class="form-control" placeholder="Nama sesuai KTP" required></div>
                <div class="mb-3"><label class="form-label fw-bold">NIM</label><input type="text" name="nim" class="form-control" placeholder="Nomor Induk Mahasiswa" required></div>
                <div class="mb-3"><label class="form-label fw-bold">Semester Baru</label><select name="semester" class="form-select"><option>2</option><option>4</option><option>6</option><option>8</option></select></div>
                <div class="mb-3"><label class="form-label fw-bold">Daftar Mata Kuliah Semester sebelumnya (10 Matkul)</label><textarea name="matkul" class="form-control" rows="4" placeholder="1. Matkul A&#10;2. Matkul B..." required></textarea></div>
                <div class="mb-3"><label class="form-label fw-bold">Tanggal Bayar</label><input type="date" name="tglTransfer" class="form-control" required></div>
                <div class="mb-3"><label class="form-label fw-bold">Upload Bukti Transfer</label><input type="file" id="bukti" class="form-control" required></div>
                <button type="submit" class="btn btn-primary w-100 p-3 fw-bold">KIRIM & DOWNLOAD BUKTI PDF</button>
            </form>
            <div id="loading" class="text-center mt-3"><div class="spinner-border text-primary"></div><p>Sabar ya, sedang memproses data...</p></div>
            <div id="result" class="mt-3"></div>
        </div>
    </div>

    <script>
        const form = document.getElementById('regForm');
        form.onsubmit = async (e) => {
            e.preventDefault();
            document.getElementById('loading').style.display = 'block';
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = "";
            
            const file = document.getElementById('bukti').files[0];
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                const payload = {
                    nama: form.nama.value, nim: form.nim.value, semester: form.semester.value,
                    matkul: form.matkul.value, tglTransfer: form.tglTransfer.value,
                    buktiTransfer: { base64: reader.result.split(',')[1], type: file.type, name: file.name }
                };

                // TEMPELKAN LINK /EXEC KAMU DISINI
                const url = 'https://script.google.com/macros/s/AKfycbznxsXINH4wKjDVy51lZZ5WgIH3cbZ4Lhk9PBKUQ1SuBddpfsbIVpsGFO7lLTbObcR3GQ/exec';

                try {
                    const response = await fetch(url, { method: 'POST', body: JSON.stringify(payload) });
                    const res = await response.json();
                    document.getElementById('loading').style.display = 'none';
                    if(res.status === 'success') {
                        resultDiv.innerHTML = `<div class="alert alert-success text-center">Registrasi Berhasil!<br><a href="${res.url}" target="_blank" class="btn btn-success mt-2">DOWNLOAD PDF</a></div>`;
                    } else { resultDiv.innerHTML = `<div class="alert alert-danger">${res.message}</div>`; }
                } catch (err) { 
                    document.getElementById('loading').style.display = 'none';
                    resultDiv.innerHTML = `<div class="alert alert-danger">Error: Gagal koneksi ke server.</div>`; 
                }
            };
        };
    </script>
</body>
</html>
